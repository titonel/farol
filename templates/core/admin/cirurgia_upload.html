{% extends 'base.html' %}

{% block title %}Upload CSV - Cirurgias - Farol{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h2><i class="bi bi-file-earmark-arrow-up"></i> Upload CSV - Cirurgias</h2>
        <p class="text-muted">Importação em massa de procedimentos cirúrgicos</p>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-cloud-upload"></i> Enviar Arquivo CSV</h5>
            </div>
            <div class="card-body">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    
                    <div class="alert alert-info">
                        <h6><i class="bi bi-info-circle"></i> Formato do Arquivo</h6>
                        <p class="mb-2">O arquivo CSV deve conter as seguintes colunas (com cabeçalho):</p>
                        <ul class="mb-0">
                            <li><code>Codigo SIGTAP</code> - Código do procedimento</li>
                            <li><code>Descricao</code> - Descrição do procedimento</li>
                            <li><code>Valor</code> - Valor em reais (pode ficar vazio, padrão: 0,00)</li>
                            <li><code>Tipo Cirurgia</code> - <strong>CMA</strong> (Cirurgias Maiores) ou <strong>cma</strong> (Cirurgias menores)</li>
                            <li><code>Especialidade</code> - Nome da especialidade (pode ficar vazio)</li>
                        </ul>
                        <div class="mt-2">
                            <small class="text-muted">
                                <i class="bi bi-check-circle"></i> Aceita vírgula (,) ou ponto e vírgula (;) como separador
                            </small>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="{{ form.arquivo_csv.id_for_label }}" class="form-label">
                            <i class="bi bi-file-earmark-text"></i> {{ form.arquivo_csv.label }}
                            <span class="text-danger">*</span>
                        </label>
                        {{ form.arquivo_csv }}
                        {% if form.arquivo_csv.errors %}
                            <div class="text-danger mt-1">
                                <small><i class="bi bi-exclamation-circle"></i> {{ form.arquivo_csv.errors }}</small>
                            </div>
                        {% endif %}
                        {% if form.arquivo_csv.help_text %}
                            <small class="form-text text-muted d-block mt-1">{{ form.arquivo_csv.help_text }}</small>
                        {% endif %}
                    </div>
                    
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle"></i> <strong>Importante:</strong>
                        <ul class="mb-0 mt-2">
                            <li>O arquivo deve estar codificado em <strong>UTF-8</strong></li>
                            <li>Delimitadores aceitos: <strong>vírgula (,)</strong> ou <strong>ponto e vírgula (;)</strong></li>
                            <li>Tipos válidos: <strong>CMA</strong> (maiúsculas) ou <strong>cma</strong> (minúsculas)</li>
                            <li>Valores vazios recebem padrão: Valor = 0,00 / Especialidade = "Não especificada"</li>
                            <li>Cirurgias com código SIGTAP já existentes serão <strong>atualizadas</strong></li>
                            <li>Linhas com erros serão ignoradas e reportadas ao final</li>
                        </ul>
                    </div>
                    
                    <hr class="my-4">
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-between">
                        <a href="{% url 'cirurgia_lista' %}" class="btn btn-secondary">
                            <i class="bi bi-arrow-left"></i> Cancelar
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-upload"></i> Fazer Upload
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    {# Sidebar com exemplo #}
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0"><i class="bi bi-file-earmark-code"></i> Exemplo com Ponto e Vírgula</h6>
            </div>
            <div class="card-body">
                <p class="small text-muted">Formato Excel/Google Sheets (ponto e vírgula):</p>
                <pre class="bg-light p-3 rounded" style="font-size: 0.70rem;">Codigo SIGTAP;Descricao;Valor;Tipo Cirurgia;Especialidade
04.07.01.012-0;Apendicectomia;;CMA;
04.08.04.015-6;Cesariana;2000.00;CMA;Obstetricia
04.03.02.008-1;Sutura simples;;cma;
04.12.01.005-3;Drenagem;250.00;cma;Cirurgia Geral</pre>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <h6 class="mb-0"><i class="bi bi-file-earmark-code"></i> Exemplo com Vírgula</h6>
            </div>
            <div class="card-body">
                <p class="small text-muted">Formato programador/editor texto (vírgula):</p>
                <pre class="bg-light p-3 rounded" style="font-size: 0.70rem;">Codigo SIGTAP,Descricao,Valor,Tipo Cirurgia,Especialidade
04.07.01.012-0,Apendicectomia,1500.00,CMA,Cirurgia Geral
04.08.04.015-6,Cesariana,2000.00,CMA,Obstetricia
04.03.02.008-1,Sutura simples,300.00,cma,Cirurgia Geral
04.12.01.005-3,Drenagem,250.00,cma,Cirurgia Geral</pre>
                
                <div class="alert alert-info mt-3">
                    <small>
                        <i class="bi bi-lightbulb"></i> <strong>Dica:</strong> Ao salvar do Excel, escolha "CSV UTF-8 (Delimitado por vírgula)" ou simplesmente "CSV".
                    </small>
                </div>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <h6 class="mb-0"><i class="bi bi-info-circle"></i> Tipos de Cirurgia</h6>
            </div>
            <div class="card-body">
                <ul class="list-unstyled small">
                    <li class="mb-2">
                        <span class="badge bg-danger">CMA</span> - Cirurgias Maiores
                        <br><small class="text-muted">Procedimentos de alta complexidade</small>
                    </li>
                    <li>
                        <span class="badge bg-warning">cma</span> - Cirurgias menores
                        <br><small class="text-muted">Procedimentos de baixa complexidade</small>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}
